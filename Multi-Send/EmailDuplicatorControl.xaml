<UserControl x:Class="Multi_Send.EmailDuplicatorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#FAFAFA"
             Focusable="True"
             IsTabStop="True">
    
    <UserControl.Resources>
        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
        
        <!-- Styles -->
        <Style x:Key="SectionStyle" TargetType="StackPanel">
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>
        
        <Style x:Key="LabelStyle" TargetType="Label">
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#323130"/>
            <Setter Property="Padding" Value="0,0,0,6"/>
        </Style>
        
        <Style x:Key="TextInputStyle" TargetType="TextBox">
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderBrush" Value="#D1D1D1"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
        
        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
        
        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <!-- Main Content -->
        <Border Background="White" Padding="16" CornerRadius="6" Margin="12">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.08" BlurRadius="4" ShadowDepth="1"/>
            </Border.Effect>
            
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- Placeholder Section -->
                    <RowDefinition Height="Auto"/>  <!-- Recipients Label -->
                    <RowDefinition Height="*"/>     <!-- Recipients List - takes remaining space -->
                    <RowDefinition Height="Auto"/>  <!-- Buttons Row -->
                    <RowDefinition Height="Auto"/>  <!-- Count Text -->
                    <RowDefinition Height="Auto"/>  <!-- Send Button Section -->
                    <RowDefinition Height="Auto"/>  <!-- Progress Section -->
                    <RowDefinition Height="Auto"/>  <!-- Status Section -->
                </Grid.RowDefinitions>
                <!-- Placeholder Section -->
                <StackPanel Grid.Row="0" Style="{StaticResource SectionStyle}">
                    <Label Content="Name Placeholder:" Style="{StaticResource LabelStyle}"/>
                    <TextBox Text="{Binding Placeholder, Mode=TwoWay}" Style="{StaticResource TextInputStyle}"/>
                </StackPanel>
                
                <!-- Recipients Label -->
                <Label Grid.Row="1" Content="Recipients &amp; Names:" Style="{StaticResource LabelStyle}" Margin="0,0,0,6"/>
                
                <!-- Recipients List - Dynamic Height -->
                <ListBox Grid.Row="2" 
                         ItemsSource="{Binding Recipients}" 
                         Background="#FAFAFA" 
                         BorderBrush="#D1D1D1" 
                         BorderThickness="1" 
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="200"/>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="50"/>
                                            <ColumnDefinition Width="30"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <TextBox Grid.Column="0" 
                                                Text="{Binding Email, Mode=TwoWay}" 
                                                FontSize="12" 
                                                Padding="8,6" 
                                                Margin="0,0,8,0"
                                                Tag="EmailInput"
                                                LostFocus="EmailTextBox_LostFocus"/>
                                        
                                        <TextBox Grid.Column="1" 
                                                Text="{Binding Name, Mode=TwoWay}" 
                                                FontSize="12" 
                                                Padding="8,6" 
                                                Margin="0,0,8,0"/>
                                        
                                        <Button Grid.Column="2" 
                                               Content="Auto" 
                                               FontSize="11" 
                                               Padding="8,4" 
                                               Margin="0,0,8,0"
                                               Command="{Binding DataContext.SuggestNameCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                               CommandParameter="{Binding}"/>
                                        
                                        <Button Grid.Column="3" 
                                               Content="Ã—" 
                                               FontSize="11" 
                                               Padding="6,2" 
                                               Background="#FDF2F2" 
                                               BorderBrush="#E74C3C" 
                                               Foreground="#E74C3C"
                                               Command="{Binding DataContext.RemoveRecipientCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                               CommandParameter="{Binding}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="White"/>
                                    <Setter Property="BorderBrush" Value="#E1E1E1"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                </ListBox>
                
                <!-- Button Row -->
                <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,8,0,0">
                    <Button Content="+ Add Recipient" 
                           Background="#F3F2F1" 
                           BorderBrush="#D1D1D1" 
                           Margin="0,0,8,0"
                           Style="{StaticResource ButtonStyle}"
                           Command="{Binding AddRecipientCommand}"/>
                    
                    <Button Content="Clear All" 
                           Background="#FDF2F2" 
                           BorderBrush="#E74C3C" 
                           Foreground="#E74C3C"
                           Style="{StaticResource ButtonStyle}"
                           Command="{Binding ClearAllCommand}"/>
                </StackPanel>
                
                <!-- Count Text -->
                <TextBlock Grid.Row="4" 
                          Text="{Binding CountText}" 
                          FontSize="11" 
                          Foreground="#605E5C" 
                          Margin="0,8,0,0" 
                          HorizontalAlignment="Right"/>
                
                <!-- Generate Button Section -->
                <StackPanel Grid.Row="5" Style="{StaticResource SectionStyle}">
                    <Button Content="Send Emails" 
                           Style="{StaticResource PrimaryButtonStyle}"
                           Command="{Binding GenerateEmailsCommand}"/>
                    
                    <TextBlock Text="This will send personalized emails immediately to all recipients" 
                              FontSize="11" 
                              Foreground="#605E5C" 
                              Margin="0,4,0,0"/>
                </StackPanel>
                
                <!-- Progress Section -->
                <StackPanel Grid.Row="6" 
                           Margin="0,8,0,0" 
                           Visibility="{Binding IsProgressVisible, Converter={StaticResource BoolToVisConverter}}">
                    <ProgressBar Height="4" 
                                Background="#EDEBE9" 
                                Foreground="#0078D4" 
                                Value="{Binding ProgressValue}"/>
                    
                    <TextBlock Text="{Binding ProgressText}" 
                              FontSize="11" 
                              Foreground="#605E5C" 
                              Margin="0,4,0,0" 
                              HorizontalAlignment="Center"/>
                </StackPanel>
                
                <!-- Status Section -->
                <Border Grid.Row="7" 
                       Margin="0,12,0,0" 
                       Padding="8" 
                       CornerRadius="3"
                       Visibility="{Binding IsStatusVisible, Converter={StaticResource BoolToVisConverter}}">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding StatusType}" Value="success">
                                        <Setter Property="Background" Value="#DFF6DD"/>
                                        <Setter Property="BorderBrush" Value="#C3E6C3"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding StatusType}" Value="error">
                                        <Setter Property="Background" Value="#FDE7E9"/>
                                        <Setter Property="BorderBrush" Value="#F5C6CB"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding StatusType}" Value="info">
                                        <Setter Property="Background" Value="#DEECF9"/>
                                        <Setter Property="BorderBrush" Value="#B6D6F2"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        
                        <TextBlock Text="{Binding StatusMessage}" FontSize="12">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding StatusType}" Value="success">
                                            <Setter Property="Foreground" Value="#107C10"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding StatusType}" Value="error">
                                            <Setter Property="Foreground" Value="#D13438"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding StatusType}" Value="info">
                                            <Setter Property="Foreground" Value="#0078D4"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                </Border>
            </Grid>
        </Border>
        
        <!-- Confirmation Dialog -->
        <Grid Background="#73000000" 
              Visibility="{Binding IsConfirmationVisible, Converter={StaticResource BoolToVisConverter}}">
            
            <Border Background="White" 
                   CornerRadius="8" 
                   Padding="20" 
                   MaxWidth="380" 
                   Margin="16" 
                   HorizontalAlignment="Center" 
                   VerticalAlignment="Center"
                   UseLayoutRounding="True" 
                   SnapsToDevicePixels="True"
                   TextOptions.TextFormattingMode="Display"
                   TextOptions.TextRenderingMode="ClearType">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="16" ShadowDepth="4" Opacity="0.1"/>
                </Border.Effect>
                
                <StackPanel>
                    <!-- Header -->
                    <TextBlock Text="Send Confirmation" 
                              FontSize="18" 
                              FontWeight="SemiBold" 
                              HorizontalAlignment="Center" 
                              Margin="0,0,0,16"/>
                    
                    <!-- Summary -->
                    <Border Background="#F8F9FA" 
                           CornerRadius="8" 
                           Padding="16" 
                           Margin="0,0,0,12">
                        <StackPanel>
                            <!-- Subject -->
                            <StackPanel Margin="0,0,0,12">
                                <TextBlock Text="SUBJECT" 
                                          FontSize="10" 
                                          Foreground="#605E5C" 
                                          Margin="0,0,0,4"/>
                                <TextBlock Text="{Binding ConfirmSubject}" 
                                          FontSize="14" 
                                          FontWeight="SemiBold" 
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                            
                            <!-- Stats -->
                            <StackPanel Orientation="Horizontal">
                                <!-- Recipients -->
                                <StackPanel HorizontalAlignment="Center" Margin="0,0,16,0">
                                    <TextBlock Text="{Binding ConfirmRecipientCount}" 
                                              FontSize="18" 
                                              FontWeight="Bold" 
                                              Foreground="#0078D4" 
                                              HorizontalAlignment="Center"/>
                                    <TextBlock Text="Recipients" 
                                              FontSize="11" 
                                              Foreground="#605E5C" 
                                              HorizontalAlignment="Center"/>
                                </StackPanel>
                                
                                <!-- Placeholder -->
                                <StackPanel HorizontalAlignment="Center" Margin="16,0">
                                    <TextBlock Text="{Binding ConfirmPlaceholder}" 
                                              FontSize="18" 
                                              FontWeight="Bold" 
                                              Foreground="#0078D4" 
                                              HorizontalAlignment="Center"/>
                                    <TextBlock Text="Placeholder" 
                                              FontSize="11" 
                                              Foreground="#605E5C" 
                                              HorizontalAlignment="Center"/>
                                </StackPanel>
                                
                                <!-- Attachments -->
                                <StackPanel HorizontalAlignment="Center" Margin="16,0,0,0">
                                    <TextBlock Text="{Binding ConfirmAttachmentCount}" 
                                              FontSize="18" 
                                              FontWeight="Bold" 
                                              Foreground="#0078D4" 
                                              HorizontalAlignment="Center"/>
                                    <TextBlock Text="Attachments" 
                                              FontSize="11" 
                                              Foreground="#605E5C" 
                                              HorizontalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- Sending Progress -->
                    <StackPanel Margin="0,0,0,20" 
                               Visibility="{Binding IsSendingInProgress, Converter={StaticResource BoolToVisConverter}}">
                        <TextBlock Text="{Binding ProgressText}" 
                                  FontSize="12" 
                                  HorizontalAlignment="Center" 
                                  Margin="0,0,0,8"/>
                        
                        <ProgressBar Height="4" 
                                    Background="#EDEBE9" 
                                    Foreground="#0078D4" 
                                    Value="{Binding ProgressValue}"/>
                    </StackPanel>
                    
                    <!-- Buttons -->
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Cancel" 
                               Background="#F3F2F1" 
                               BorderBrush="#D1D1D1" 
                               BorderThickness="1" 
                               Padding="16,8" 
                               FontSize="13" 
                               Margin="0,0,12,0"
                               Style="{StaticResource ButtonStyle}"
                               Command="{Binding CancelSendCommand}"/>
                        
                        <Button Content="Send Emails" 
                               Background="#0078D4" 
                               Foreground="White" 
                               BorderThickness="0" 
                               Padding="16,8" 
                               FontSize="13" 
                               FontWeight="SemiBold"
                               Style="{StaticResource ButtonStyle}"
                               Command="{Binding ConfirmSendCommand}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
